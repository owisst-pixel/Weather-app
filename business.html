<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prekybos Valdymo Sistema</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 11px;
            opacity: 0.9;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            margin-top: 5px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .card-header {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .order-list {
            display: grid;
            gap: 15px;
        }
        
        .order-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .order-id {
            font-weight: 700;
            color: #1f2937;
            font-size: 16px;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .status-planning { background: #fef3c7; color: #92400e; }
        .status-ordered { background: #dbeafe; color: #1e40af; }
        .status-shipping { background: #e0e7ff; color: #4338ca; }
        .status-arrived { background: #dcfce7; color: #166534; }
        .status-sold { background: #d1fae5; color: #065f46; }
        
        .order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 13px;
            margin-top: 10px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        
        .detail-label {
            color: #6b7280;
        }
        
        .detail-value {
            font-weight: 600;
            color: #1f2937;
        }
        
        .profit-positive {
            color: #10b981;
        }
        
        .profit-negative {
            color: #ef4444;
        }
        
        .timeline {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        
        .timeline-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 12px;
        }
        
        .timeline-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            margin-top: 5px;
            flex-shrink: 0;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-date {
            color: #6b7280;
            font-size: 11px;
        }
        
        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .order-actions .btn {
            flex: 1;
            padding: 8px;
            font-size: 13px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stat-box-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .stat-box-value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .header-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .order-details {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üö¢ Prekybos Valdymo Sistema</h1>
        <p style="font-size: 13px; opacity: 0.9;">Azija ‚Üí Europa Import/Export Platform</p>
        
        <div class="header-stats">
            <div class="stat-card">
                <div class="stat-label">Aktyv≈´s u≈æsakymai</div>
                <div class="stat-value" id="activeOrders">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">≈†io mƒón. pelnas</div>
                <div class="stat-value" id="monthProfit">‚Ç¨0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Viso apyvarta</div>
                <div class="stat-value" id="totalRevenue">‚Ç¨0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Planuojama</div>
                <div class="stat-value" id="plannedOrders">0</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="showTab('orders')">üì¶ U≈æsakymai</button>
            <button class="tab" onclick="showTab('new')">‚ûï Naujas</button>
            <button class="tab" onclick="showTab('analytics')">üìà Analizƒó</button>
        </div>
        
        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-box-label">Vidutinis pelnas u≈æ u≈æsakymƒÖ</div>
                    <div class="stat-box-value" id="avgProfit">‚Ç¨0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-label">Vidutinƒó mar≈æ–∞</div>
                    <div class="stat-box-value" id="avgMargin">0%</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    üìå Naujausi u≈æsakymai
                </div>
                <div id="recentOrders"></div>
            </div>
        </div>
        
        <!-- ORDERS TAB -->
        <div id="orders" class="tab-content">
            <div class="card">
                <div class="card-header">
                    Visi u≈æsakymai
                    <select id="filterStatus" onchange="filterOrders()" class="form-select" style="width: auto; padding: 8px;">
                        <option value="all">Visi statusai</option>
                        <option value="planning">Planuojama</option>
                        <option value="ordered">U≈æsakyta</option>
                        <option value="shipping">Gabenama</option>
                        <option value="arrived">Atvyko</option>
                        <option value="sold">Parduota</option>
                    </select>
                </div>
                <div id="ordersList"></div>
            </div>
        </div>
        
        <!-- NEW ORDER TAB -->
        <div id="new" class="tab-content">
            <div class="card">
                <div class="card-header">‚ûï Naujas u≈æsakymas</div>
                
                <form id="newOrderForm">
                    <div class="form-group">
                        <label class="form-label">Produkto pavadinimas *</label>
                        <input type="text" class="form-input" id="productName" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Tiekƒójas (Azija) *</label>
                            <input type="text" class="form-input" id="supplier" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">≈†alis</label>
                            <select class="form-select" id="supplierCountry">
                                <option value="Kinija">Kinija</option>
                                <option value="Vietnamas">Vietnamas</option>
                                <option value="Tailandas">Tailandas</option>
                                <option value="Malaizija">Malaizija</option>
                                <option value="Indonezija">Indonezija</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Kiekis (vnt) *</label>
                            <input type="number" class="form-input" id="quantity" required min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Vienetas</label>
                            <select class="form-select" id="unit">
                                <option value="vnt">vnt</option>
                                <option value="m¬≥">m¬≥</option>
                                <option value="kg">kg</option>
                                <option value="konteineris">konteineris</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Pirkimo kaina (u≈æ vnt) ‚Ç¨ *</label>
                            <input type="number" class="form-input" id="buyPrice" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Gabavimo kaina ‚Ç¨ *</label>
                            <input type="number" class="form-input" id="shippingCost" required min="0" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Pardavimo kaina (u≈æ vnt) ‚Ç¨ *</label>
                            <input type="number" class="form-input" id="sellPrice" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pirkƒójas (Europa)</label>
                            <input type="text" class="form-input" id="buyer">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Pastabos</label>
                        <textarea class="form-textarea" id="notes"></textarea>
                    </div>
                    
                    <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">üìä Automatinis skaiƒçiavimas:</div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Bendra pirkimo kaina:</span>
                            <span id="calcTotalBuy">‚Ç¨0.00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Bendra pardavimo kaina:</span>
                            <span id="calcTotalSell">‚Ç¨0.00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 16px; padding-top: 10px; border-top: 1px solid #e5e7eb;">
                            <span>Planuojamas pelnas:</span>
                            <span id="calcProfit" style="color: #10b981;">‚Ç¨0.00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>Mar≈æa:</span>
                            <span id="calcMargin">0%</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üíæ Sukurti u≈æsakymƒÖ
                    </button>
                </form>
            </div>
        </div>
        
        <!-- ANALYTICS TAB -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <div class="card-header">üìà Verslo analizƒó</div>
                <div id="analyticsContent"></div>
            </div>
        </div>
    </div>
    
    <!-- ORDER DETAILS MODAL -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">U≈æsakymo detalƒós</div>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let orders = [];
        
        // Load from localStorage
        function loadOrders() {
            const saved = localStorage.getItem('trade_orders');
            if (saved) {
                orders = JSON.parse(saved);
            }
            updateDashboard();
            renderOrders();
        }
        
        function saveOrders() {
            localStorage.setItem('trade_orders', JSON.stringify(orders));
            updateDashboard();
        }
        
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'orders') {
                renderOrders();
            } else if (tabName === 'dashboard') {
                renderDashboard();
            } else if (tabName === 'analytics') {
                renderAnalytics();
            }
        }
        
        // Calculate live preview
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = ['quantity', 'buyPrice', 'shippingCost', 'sellPrice'];
            inputs.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', calculatePreview);
                }
            });
            loadOrders();
        });
        
        function calculatePreview() {
            const qty = parseFloat(document.getElementById('quantity').value) || 0;
            const buy = parseFloat(document.getElementById('buyPrice').value) || 0;
            const ship = parseFloat(document.getElementById('shippingCost').value) || 0;
            const sell = parseFloat(document.getElementById('sellPrice').value) || 0;
            
            const totalBuy = (qty * buy) + ship;
            const totalSell = qty * sell;
            const profit = totalSell - totalBuy;
            const margin = totalBuy > 0 ? ((profit / totalBuy) * 100) : 0;
            
            document.getElementById('calcTotalBuy').textContent = '‚Ç¨' + totalBuy.toFixed(2);
            document.getElementById('calcTotalSell').textContent = '‚Ç¨' + totalSell.toFixed(2);
            document.getElementById('calcProfit').textContent = '‚Ç¨' + profit.toFixed(2);
            document.getElementById('calcProfit').style.color = profit >= 0 ? '#10b981' : '#ef4444';
            document.getElementById('calcMargin').textContent = margin.toFixed(1) + '%';
        }
        
        // Create new order
        document.getElementById('newOrderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const qty = parseFloat(document.getElementById('quantity').value);
            const buy = parseFloat(document.getElementById('buyPrice').value);
            const ship = parseFloat(document.getElementById('shippingCost').value);
            const sell = parseFloat(document.getElementById('sellPrice').value);
            
            const order = {
                id: 'ORD-' + Date.now(),
                productName: document.getElementById('productName').value,
                supplier: document.getElementById('supplier').value,
                supplierCountry: document.getElementById('supplierCountry').value,
                quantity: qty,
                unit: document.getElementById('unit').value,
                buyPrice: buy,
                shippingCost: ship,
                sellPrice: sell,
                buyer: document.getElementById('buyer').value,
                notes: document.getElementById('notes').value,
                status: 'planning',
                createdDate: new Date().toISOString(),
                timeline: [
                    { date: new Date().toISOString(), event: 'U≈æsakymas sukurtas', status: 'planning' }
                ]
            };
            
            orders.unshift(order);
            saveOrders();
            
            document.getElementById('newOrderForm').reset();
            calculatePreview();
            
            alert('‚úÖ U≈æsakymas sƒókmingai sukurtas!');
            showTab('orders');
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab')[1].classList.add('active');
        });
        
        function renderOrders() {
            const filter = document.getElementById('filterStatus').value;
            const filtered = filter === 'all' ? orders : orders.filter(o => o.status === filter);
            
            const container = document.getElementById('ordersList');
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <div>Nƒóra u≈æsakym≈≥</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(order => {
                const totalBuy = (order.quantity * order.buyPrice) + order.shippingCost;
                const totalSell = order.quantity * order.sellPrice;
                const profit = totalSell - totalBuy;
                const margin = ((profit / totalBuy) * 100).toFixed(1);
                
                return `
                    <div class="order-card">
                        <div class="order-header">
                            <div class="order-id">${order.id}</div>
                            <span class="status-badge status-${order.status}">
                                ${getStatusText(order.status)}
                            </span>
                        </div>
                        
                        <div style="font-weight: 600; margin-bottom: 8px;">
                            ${order.productName}
                        </div>
                        
                        <div class="order-details">
                            <div class="detail-item">
                                <span class="detail-label">Tiekƒójas:</span>
                                <span class="detail-value">${order.supplier}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Kiekis:</span>
                                <span class="detail-value">${order.quantity} ${order.unit}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Pirkimas:</span>
                                <span class="detail-value">‚Ç¨${totalBuy.toFixed(2)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Pardavimas:</span>
                                <span class="detail-value">‚Ç¨${totalSell.toFixed(2)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Pelnas:</span>
                                <span class="detail-value ${profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                                    ‚Ç¨${profit.toFixed(2)} (${margin}%)
                                </span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Data:</span>
                                <span class="detail-value">${new Date(order.createdDate).toLocaleDateString()}</span>
                            </div>
                        </div>
                        
                        <div class="order-actions">
                            <button class="btn btn-primary" onclick="viewOrder('${order.id}')">
                                üëÅÔ∏è Detalƒós
                            </button>
                            <button class="btn btn-success" onclick="updateStatus('${order.id}')">
                                ‚è≠Ô∏è Statusas
                            </button>
                            <button class="btn btn-danger" onclick="deleteOrder('${order.id}')">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getStatusText(status) {
            const texts = {
                'planning': 'Planuojama',
                'ordered': 'U≈æsakyta',
                'shipping': 'Gabenama',
                'arrived': 'Atvyko',
                'sold': 'Parduota'
            };
            return texts[status] || status;
        }
        
        function filterOrders() {
            renderOrders();
        }
        
        function viewOrder(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            const totalBuy = (order.quantity * order.buyPrice) + order.shippingCost;
            const totalSell = order.quantity * order.sellPrice;
            const profit = totalSell - totalBuy;
            const margin = ((profit / totalBuy) * 100).toFixed(1);
            
            document.getElementById('modalTitle').textContent = order.id;
            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">${order.productName}</h3>
                    <span class="status-badge status-${order.status}">${getStatusText(order.status)}</span>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #667eea;">üì¶ Produkto informacija</h4>
                    <div class="detail-item">
                        <span class="detail-label">Kiekis:</span>
                        <span class="detail-value">${order.quantity} ${order.unit}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Tiekƒójas:</span>
                        <span class="detail-value">${order.supplier} (${order.supplierCountry})</span>
                    </div>
                    ${order.buyer ? `
                    <div class="detail-item">
                        <span class="detail-label">Pirkƒójas:</span>
                        <span class="detail-value">${order.buyer}</span>
                    </div>
                    ` : ''}
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #667eea;">üí∞ Finansai</h4>
                    <div class="detail-item">
                        <span class="detail-label">Pirkimo kaina (vnt):</span>
                        <span class="detail-value">‚Ç¨${order.buyPrice.toFixed(2)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Gabavimo kaina:</span>
                        <span class="detail-value">‚Ç¨${order.shippingCost.toFixed(2)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Pardavimo kaina (vnt):</span>
                        <span class="detail-value">‚Ç¨${order.sellPrice.toFixed(2)}</span>
                    </div>
                    <div class="detail-item" style="border-top: 2px solid #e5e7eb; padding-top: 10px; margin-top: 10px;">
                        <span class="detail-label"><strong>Bendra investicija:</strong></span>
                        <span class="detail-value">‚Ç¨${totalBuy.toFixed(2)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"><strong>Bendra apyvarta:</strong></span>
                        <span class="detail-value">‚Ç¨${totalSell.toFixed(2)}</span>
                    </div>
                    <div class="detail-item" style="font-size: 16px;">
                        <span class="detail-label"><strong>PELNAS:</strong></span>
                        <span class="detail-value ${profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                            ‚Ç¨${profit.toFixed(2)} (${margin}%)
                        </span>
                    </div>
                </div>
                
                ${order.notes ? `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #667eea;">üìù Pastabos</h4>
                    <p style="background: #f9fafb; padding: 10px; border-radius: 6px;">${order.notes}</p>
                </div>
                ` : ''}
                
                <div>
                    <h4 style="margin-bottom: 10px; color: #667eea;">üïí Laiko juosta</h4>
                    ${order.timeline.map(t => `
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <div>${t.event}</div>
                                <div class="timeline-date">${new Date(t.date).toLocaleString()}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('orderModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('orderModal').classList.remove('active');
        }
        
        function updateStatus(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            const statuses = ['planning', 'ordered', 'shipping', 'arrived', 'sold'];
            const currentIndex = statuses.indexOf(order.status);
            
            if (currentIndex < statuses.length - 1) {
                order.status = statuses[currentIndex + 1];
                order.timeline.push({
                    date: new Date().toISOString(),
                    event: `Statusas pakeistas ƒØ: ${getStatusText(order.status)}`,
                    status: order.status
                });
                saveOrders();
                renderOrders();
            } else {
                alert('U≈æsakymas jau parduotas!');
            }
        }
        
        function deleteOrder(id) {
            if (confirm('Ar tikrai norite i≈°trinti ≈°ƒØ u≈æsakymƒÖ?')) {
                orders = orders.filter(o => o.id !== id);
                saveOrders();
                renderOrders();
            }
        }
        
        function updateDashboard() {
            const active = orders.filter(o => o.status !== 'sold').length;
            const planned = orders.filter(o => o.status === 'planning').length;
            
            const thisMonth = orders.filter(o => {
                const orderDate = new Date(o.createdDate);
                const now = new Date();
                return orderDate.getMonth() === now.getMonth() && 
                       orderDate.getFullYear() === now.getFullYear() &&
                       o.status === 'sold';
            });
            
            const monthProfit = thisMonth.reduce((sum, o) => {
                const totalBuy = (o.quantity * o.buyPrice) + o.shippingCost;
                const totalSell = o.quantity * o.sellPrice;
                return sum + (totalSell - totalBuy);
            }, 0);
            
            const totalRev = orders.filter(o => o.status === 'sold').reduce((sum, o) => {
                return sum + (o.quantity * o.sellPrice);
            }, 0);
            
            document.getElementById('activeOrders').textContent = active;
            document.getElementById('plannedOrders').textContent = planned;
            document.getElementById('monthProfit').textContent = '‚Ç¨' + monthProfit.toFixed(0);
            document.getElementById('totalRevenue').textContent = '‚Ç¨' + totalRev.toFixed(0);
        }
        
        function renderDashboard() {
            const recent = orders.slice(0, 5);
            const container = document.getElementById('recentOrders');
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <div>Nƒóra u≈æsakym≈≥. Sukurkite naujƒÖ!</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(order => {
                const totalBuy = (order.quantity * order.buyPrice) + order.shippingCost;
                const totalSell = order.quantity * order.sellPrice;
                const profit = totalSell - totalBuy;
                
                return `
                    <div class="order-card" style="margin-bottom: 15px;">
                        <div class="order-header">
                            <div class="order-id">${order.productName}</div>
                            <span class="status-badge status-${order.status}">${getStatusText(order.status)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px;">
                            <span>Pelnas:</span>
                            <span class="${profit >= 0 ? 'profit-positive' : 'profit-negative'}" style="font-weight: 700;">
                                ‚Ç¨${profit.toFixed(2)}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Calculate avg stats
            const soldOrders = orders.filter(o => o.status === 'sold');
            if (soldOrders.length > 0) {
                const avgProfit = soldOrders.reduce((sum, o) => {
                    const totalBuy = (o.quantity * o.buyPrice) + o.shippingCost;
                    const totalSell = o.quantity * o.sellPrice;
                    return sum + (totalSell - totalBuy);
                }, 0) / soldOrders.length;
                
                const avgMargin = soldOrders.reduce((sum, o) => {
                    const totalBuy = (o.quantity * o.buyPrice) + o.shippingCost;
                    const totalSell = o.quantity * o.sellPrice;
                    const profit = totalSell - totalBuy;
                    return sum + ((profit / totalBuy) * 100);
                }, 0) / soldOrders.length;
                
                document.getElementById('avgProfit').textContent = '‚Ç¨' + avgProfit.toFixed(2);
                document.getElementById('avgMargin').textContent = avgMargin.toFixed(1) + '%';
            }
        }
        
        function renderAnalytics() {
            const container = document.getElementById('analyticsContent');
            
            const byStatus = {};
            orders.forEach(o => {
                byStatus[o.status] = (byStatus[o.status] || 0) + 1;
            });
            
            const totalProfit = orders.filter(o => o.status === 'sold').reduce((sum, o) => {
                const totalBuy = (o.quantity * o.buyPrice) + o.shippingCost;
                const totalSell = o.quantity * o.sellPrice;
                return sum + (totalSell - totalBuy);
            }, 0);
            
            const totalInvested = orders.reduce((sum, o) => {
                return sum + ((o.quantity * o.buyPrice) + o.shippingCost);
            }, 0);
            
            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-box-label">Viso u≈æsakym≈≥</div>
                        <div class="stat-box-value">${orders.length}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-label">Parduota</div>
                        <div class="stat-box-value">${byStatus.sold || 0}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-label">Viso pelno (parduota)</div>
                        <div class="stat-box-value" style="color: #10b981;">‚Ç¨${totalProfit.toFixed(2)}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-label">Investuota</div>
                        <div class="stat-box-value">‚Ç¨${totalInvested.toFixed(2)}</div>
                    </div>
                </div>
                
                <h3 style="margin: 20px 0 10px;">Pagal statusƒÖ:</h3>
                ${Object.entries(byStatus).map(([status, count]) => `
                    <div style="display: flex; justify-content: space-between; padding: 10px; background: #f9fafb; margin-bottom: 5px; border-radius: 6px;">
                        <span>${getStatusText(status)}</span>
                        <strong>${count}</strong>
                    </div>
                `).join('')}
            `;
        }
        
        // Close modal on outside click
        document.getElementById('orderModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
