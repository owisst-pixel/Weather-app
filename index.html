<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="OrÅ³ PrognozÄ—s">
    <link rel="manifest" href="manifest.json">
    <title>OrÅ³ PrognozÄ—s</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .app {
            max-width: 100%;
            min-height: 100vh;
            background: white;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: max(20px, env(safe-area-inset-top)) 20px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
        }
        
        select, button {
            width: 100%;
            padding: 14px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            background: white;
        }
        
        button {
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .status {
            padding: 12px 20px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status.loading {
            background: #fff3e0;
            color: #e65100;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
        }
        
        .output {
            padding: 20px;
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }
        
        .forecast-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
        }
        
        .forecast-date {
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .forecast-temp {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .description {
            color: #666;
            font-size: 14px;
        }
        
        .empty {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }
        
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: none;
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .install-prompt button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>ğŸŒ¤ï¸ OrÅ³ PrognozÄ—s</h1>
            <p>Lietuvos miestams</p>
        </div>
        
        <div class="controls">
            <select id="city">
                <option value="Vilnius">Vilnius</option>
                <option value="Kaunas">Kaunas</option>
                <option value="KlaipÄ—da">KlaipÄ—da</option>
                <option value="Å iauliai">Å iauliai</option>
                <option value="PanevÄ—Å¾ys">PanevÄ—Å¾ys</option>
            </select>
            
            <button class="btn-primary" onclick="getForecast()">ğŸ”„ Gauti prognozÄ™</button>
            <button class="btn-secondary" onclick="showChanges()">ğŸ“Š Rodyti pokyÄius</button>
        </div>
        
        <div id="status" class="status success">PasirengÄ™s</div>
        
        <div id="output" class="output">
            <div class="empty">
                Paspauskite "ğŸ”„ Gauti prognozÄ™" pradÅ¾iai
            </div>
        </div>
    </div>
    
    <div id="installPrompt" class="install-prompt">
        <strong>ğŸ“± Ä®diekite aplikacijÄ…!</strong>
        <p style="margin-top: 5px; color: #666; font-size: 14px;">
            PridÄ—kite prie pagrindinio ekrano ir naudokite kaip tikrÄ… aplikacijÄ…
        </p>
        <button class="btn-primary" onclick="installApp()">Ä®diegti</button>
        <button style="background: #ccc; color: #333;" onclick="closeInstall()">VÄ—liau</button>
    </div>

    <script>
        const cities = {
            "Vilnius": [54.6872, 25.2797],
            "Kaunas": [54.8985, 23.9036],
            "KlaipÄ—da": [55.7033, 21.1443],
            "Å iauliai": [55.9349, 23.3137],
            "PanevÄ—Å¾ys": [55.7348, 24.3570]
        };
        
        const weatherCodes = {
            0: "Giedra", 1: "Giedra", 2: "DalinÄ— debesuotumas", 3: "Debesuota",
            61: "Lietus", 63: "Lietus", 65: "Smarkas lietus",
            71: "Sniegas", 73: "Sniegas", 75: "Smarkas sniegas",
            95: "PerkÅ«nija"
        };
        
        // PWA Install
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                    closeInstall();
                });
            }
        }
        
        function closeInstall() {
            document.getElementById('installPrompt').style.display = 'none';
        }
        
        // LocalStorage DB
        function saveForecasts(city, forecasts) {
            const key = `forecasts_${city}_${new Date().toISOString().split('T')[0]}`;
            const existing = JSON.parse(localStorage.getItem('allForecasts') || '{}');
            existing[key] = forecasts;
            localStorage.setItem('allForecasts', JSON.stringify(existing));
        }
        
        function getAllForecasts(city) {
            const all = JSON.parse(localStorage.getItem('allForecasts') || '{}');
            return Object.entries(all)
                .filter(([key]) => key.startsWith(`forecasts_${city}`))
                .map(([key, value]) => ({
                    date: key.split('_')[2],
                    forecasts: value
                }));
        }
        
        function updateStatus(text, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = text;
            status.className = 'status ' + type;
        }
        
        async function getForecast() {
            const city = document.getElementById('city').value;
            const [lat, lon] = cities[city];
            const output = document.getElementById('output');
            
            updateStatus('Gaunama prognozÄ—...', 'loading');
            
            try {
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=Europe/Vilnius&forecast_days=10`
                );
                const data = await response.json();
                const daily = data.daily;
                
                const forecasts = [];
                let html = '<div style="text-align: center; margin-bottom: 20px;">';
                html += '<h2 style="color: #667eea;">âœ… Nauja prognozÄ—</h2>';
                html += `<p style="color: #666;">${new Date().toLocaleString('lt-LT')}</p></div>`;
                
                for (let i = 0; i < 10; i++) {
                    const forecast = {
                        date: daily.time[i],
                        min: daily.temperature_2m_min[i],
                        max: daily.temperature_2m_max[i],
                        desc: weatherCodes[daily.weathercode[i]] || 'NeÅ¾inoma'
                    };
                    forecasts.push(forecast);
                    
                    html += `
                        <div class="forecast-card">
                            <div class="forecast-date">ğŸ“… ${forecast.date}</div>
                            <div class="forecast-temp">${forecast.min.toFixed(1)}Â°C - ${forecast.max.toFixed(1)}Â°C</div>
                            <div class="description">â˜ï¸ ${forecast.desc}</div>
                        </div>
                    `;
                }
                
                saveForecasts(city, forecasts);
                output.innerHTML = html;
                updateStatus('PrognozÄ— gauta!', 'success');
                
            } catch (error) {
                output.innerHTML = `<div class="empty">âŒ Klaida: ${error.message}</div>`;
                updateStatus('Klaida', 'error');
            }
        }
        
        function showChanges() {
            const city = document.getElementById('city').value;
            const output = document.getElementById('output');
            const allForecasts = getAllForecasts(city);
            
            if (allForecasts.length === 0) {
                output.innerHTML = '<div class="empty">âš ï¸ NÄ—ra iÅ¡saugotÅ³ prognoziÅ³</div>';
                updateStatus('NÄ—ra duomenÅ³', 'loading');
                return;
            }
            
            let html = '<div style="text-align: center; margin-bottom: 20px;">';
            html += '<h2 style="color: #667eea;">ğŸ“Š PrognoziÅ³ istorija</h2></div>';
            
            allForecasts.forEach(({date, forecasts}) => {
                html += `<div style="background: #e3f2fd; padding: 15px; border-radius: 12px; margin-bottom: 15px;">`;
                html += `<h3 style="margin-bottom: 10px;">ğŸ“… ${date}</h3>`;
                forecasts.slice(0, 5).forEach((f, i) => {
                    html += `
                        <div style="padding: 8px; background: white; border-radius: 8px; margin-bottom: 8px;">
                            <strong>${f.date}</strong>: ${f.min.toFixed(1)}Â°C - ${f.max.toFixed(1)}Â°C | ${f.desc}
                        </div>
                    `;
                });
                html += `</div>`;
            });
            
            output.innerHTML = html;
            updateStatus('Istorija parodyta', 'success');
        }
        
        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
